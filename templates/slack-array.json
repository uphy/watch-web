{{ define "blocks" }}
{
    "color": "{{ if eq .Type "insert"}}#0000FF{{ else }}#FF0000{{ end }}",
    "blocks": [
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "*[{{ if eq .Type "insert" }}Add{{ else }}Remove{{ end }}]* <{{ .Object.link }}|{{ .Object.summary}}>\n{{ .Object.description }}"
            }
        },
        {
            "type": "section",
            "fields": [
                {{ range $index, $elm := (toArrayExcludes .Object "link" "summary" "description" "thumbnail") }}
                {{     if not (eq $index 0) }},{{ end }}
                {
                    "type": "mrkdwn",
                    "text": "*{{ $elm.key }}:*\n{{ $elm.value }}"
                }
                {{ end }}
            ]
        },
        {
            "type": "image",
            "image_url": "{{ .Object.thumbnail }}",
            "alt_text": "{{ .Object.summary }}"
        },
        {
            "type": "divider"
        }
    ]
}
{{ end }}
{
    "text": "<!channel> <{{ .res.Link }}|{{ .res.Label }}> has been updated",
    "blocks": [],
    "attachments": [
        {{ range $index, $change := .changes }}
        {{   if not (eq $change.Type "equal") }}
        {{     if $index }},{{ end }}
        {{     template "blocks" $change }}
        {{   end }}
        {{ end }}
    ]
}